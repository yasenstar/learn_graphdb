<map version="freeplane 1.12.1">
<!--To view this file, download free mind mapping software Freeplane from https://www.freeplane.org -->
<node TEXT="Cypher_Aggregations&#xa;(Neo4j Graph Academy)" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1090958577" CREATED="1409300609620" MODIFIED="1767063050546">
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<font BOLD="true"/>
<hook NAME="MapStyle" background="#eeeeeeff">
    <properties show_icon_for_attributes="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff" show_note_icons="true" fit_to_viewport="false" show_icons="BESIDE_NODES" associatedTemplateLocation="template:/light_grey_template.mm" show_tags="UNDER_NODES"/>
    <tags category_separator="::"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24 pt">
<font SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="bottom_or_right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="default" ID="ID_364653791" ICON_SIZE="12 pt" FORMAT_AS_HYPERLINK="false" COLOR="#222222" BACKGROUND_COLOR="#eeeeee" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="8 pt" SHAPE_VERTICAL_MARGIN="5 pt" BORDER_WIDTH_LIKE_EDGE="false" BORDER_WIDTH="1.9 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0" BORDER_DASH_LIKE_EDGE="true" BORDER_DASH="SOLID" VGAP_QUANTITY="3 pt">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#676767" WIDTH="2" TRANSPARENCY="255" DASH="" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_364653791" STARTINCLINATION="122.25 pt;0 pt;" ENDINCLINATION="119.25 pt;35.25 pt;" STARTARROW="NONE" ENDARROW="DEFAULT"/>
<font NAME="SansSerif" SIZE="11" BOLD="false" STRIKETHROUGH="false" ITALIC="false"/>
<edge STYLE="bezier" COLOR="#444444" WIDTH="3" DASH="SOLID"/>
<richcontent TYPE="DETAILS" CONTENT-TYPE="plain/auto"/>
<richcontent TYPE="NOTE" CONTENT-TYPE="plain/auto"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details"/>
<stylenode LOCALIZED_TEXT="defaultstyle.tags">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes">
<font SIZE="9"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#f6f9a1" TEXT_ALIGN="LEFT"/>
<stylenode LOCALIZED_TEXT="defaultstyle.floating">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.selection" COLOR="#ffffff" BACKGROUND_COLOR="#3333ff" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#3333ff"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="bottom_or_right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="styles.important" ID="ID_1533685614" COLOR="#443333" BACKGROUND_COLOR="#dddddd" BORDER_WIDTH="3 px" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<icon BUILTIN="yes"/>
<arrowlink COLOR="#cc0033" TRANSPARENCY="255" DESTINATION="ID_1533685614"/>
<font SIZE="12" BOLD="true"/>
<edge COLOR="#cc0033"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.flower" COLOR="#ffffff" BACKGROUND_COLOR="#255aba" STYLE="oval" TEXT_ALIGN="CENTER" BORDER_WIDTH_LIKE_EDGE="false" BORDER_WIDTH="22 pt" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#f9d71c" BORDER_DASH_LIKE_EDGE="false" BORDER_DASH="CLOSE_DOTS" MAX_WIDTH="6 cm" MIN_WIDTH="3 cm"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="bottom_or_right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#ffffff" BACKGROUND_COLOR="#000000" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#2c2b29" BORDER_DASH_LIKE_EDGE="true">
<font NAME="Ubuntu" SIZE="18"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#ffffff" BACKGROUND_COLOR="#222222" BORDER_COLOR="#2c2b29">
<font NAME="Ubuntu" SIZE="16"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#ffffff" BACKGROUND_COLOR="#444444" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<font SIZE="14"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#ffffff" BACKGROUND_COLOR="#676767" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<font SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#ffffff" BACKGROUND_COLOR="#888888" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<font SIZE="11"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#222222" BACKGROUND_COLOR="#aaaaaa" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<font SIZE="11"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" COLOR="#222222" BACKGROUND_COLOR="#bbbbbb" BORDER_COLOR_LIKE_EDGE="true" BORDER_COLOR="#f0f0f0">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,7" COLOR="#222222" BACKGROUND_COLOR="#cccccc" BORDER_COLOR="#f0f0f0">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,8" COLOR="#222222" BACKGROUND_COLOR="#dddddd" BORDER_COLOR="#f0f0f0">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,9" COLOR="#222222" BACKGROUND_COLOR="#eeeeee" BORDER_COLOR="#f0f0f0">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,10" COLOR="#2c2b29" BACKGROUND_COLOR="#ffffff" BORDER_COLOR="#f0f0f0">
<font SIZE="9"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,11" COLOR="#222222" BACKGROUND_COLOR="#ffffff" BORDER_COLOR="#f0f0f0">
<font SIZE="9"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<node TEXT="1. Understanding Aggregation in Cypher" FOLDED="true" POSITION="bottom_or_right" ID="ID_1353126640" CREATED="1767063104049" MODIFIED="1767063540484"><richcontent TYPE="NOTE">
<html>
  <head>
    
  </head>
  <body>
    <p>
      Aggregation in Cypher means that during a query, the data retrieved is collected or counted. The aggregation of values or counts are either returned from the query or are used as input for the next part of a multi-step query. If you view the execution plan for the query, you will see that rows are returned for a step in the query. The rows that are returned in a query step are an aggregation of property values, nodes, relationships, or paths in the graph. There are some best practices for aggregating data during your query that you can better understand with examples and explanations of how the query works at runtime.
    </p>
  </body>
</html></richcontent>
<node TEXT="1.1 Creating Lists" ID="ID_123729866" CREATED="1767063131217" MODIFIED="1767063135779">
<node TEXT="A list is an array that contains elements. The elements in a list need not all be of the same type." ID="ID_150817629" CREATED="1767065018609" MODIFIED="1767065048421"/>
<node TEXT="Most queries use collect() to create lists, but there&apos;re other functions you can use as well, such as nodes()." ID="ID_875158660" CREATED="1767065248817" MODIFIED="1767065283027">
<node TEXT="collect() returns a list of elements, which is used to create a list at any time during the query." ID="ID_910298048" CREATED="1767065575388" MODIFIED="1767065605263"/>
<node TEXT="When you create a list during the query, aggregation occurs." ID="ID_305010646" CREATED="1767065605548" MODIFIED="1767065624336"/>
</node>
<node TEXT="During aggregation, the graph engine typically groups data based upon some value in a row." ID="ID_1877126064" CREATED="1767065679275" MODIFIED="1767065710127">
<node ID="ID_1874473668" CREATED="1767065781416" MODIFIED="1767065795808"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      The non-aggregated value is the <span style="font-weight: bold;">grouping key</span><span style="font-weight: normal;">.</span>
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="Collecting Nodes" ID="ID_1899320626" CREATED="1767075197485" MODIFIED="1767075204895">
<node TEXT="MATCH (m:Movie)" ID="ID_1840564092" CREATED="1767075204901" MODIFIED="1767075216091">
<node TEXT="This Match retrieve all Movie nodes" ID="ID_1415717096" CREATED="1767075216096" MODIFIED="1767075229105"/>
</node>
<node TEXT="UNWIND m.languages AS language" ID="ID_880097630" CREATED="1767075230301" MODIFIED="1767075242573">
<node TEXT="Each value in the languages property is returned" ID="ID_1979936409" CREATED="1767075242576" MODIFIED="1767075253584"/>
</node>
<node TEXT="WITH language, collect(m) AS movies" ID="ID_1232931079" CREATED="1767075260460" MODIFIED="1767075272669">
<node TEXT="Collect the movie nodes and use the value of language as the grouping key. that is all of the movies with a value of English will be collected into a list." ID="ID_361131703" CREATED="1767075272673" MODIFIED="1767075313615"/>
</node>
<node TEXT="MERGE (l:Language {name:language})" ID="ID_1618212457" CREATED="1767075314893" MODIFIED="1767075330655">
<node TEXT="Create the Language node using the language value" ID="ID_776123247" CREATED="1767075330660" MODIFIED="1767075339840"/>
</node>
<node TEXT="WITH l, movies&#xa;UNWIND movies AS m" ID="ID_1016546801" CREATED="1767075341437" MODIFIED="1767075367323">
<node TEXT="With the language value and the list of Movie nodes for that language, we unwind the movie nodes into rows." ID="ID_1118977299" CREATED="1767075367331" MODIFIED="1767075387855"/>
</node>
<node TEXT="WITH l, m&#xa;MERGE (l)&lt;-[:SPEAKS]-(m)" ID="ID_1062467475" CREATED="1767075397197" MODIFIED="1767075417005">
<node TEXT="With each language and row for each Movie, we create the relationship between the Language node and the Movie node" ID="ID_1628749666" CREATED="1767075417013" MODIFIED="1767075446829"/>
</node>
</node>
<node TEXT="Collecting Relationships" ID="ID_1233410535" CREATED="1767075479308" MODIFIED="1767075484575">
<node TEXT="Use endNode() to return the node as the end of the relationship" ID="ID_1939690916" CREATED="1767075616907" MODIFIED="1767075637983"/>
</node>
<node TEXT="Collecting paths in a query" ID="ID_1011654187" CREATED="1767075678346" MODIFIED="1767075684734">
<node TEXT="nodes() function returns the list of all nodes in a path" ID="ID_721914261" CREATED="1767075696221" MODIFIED="1767075709389"/>
</node>
</node>
<node TEXT="1.2 Creating and Working with Lists" ID="ID_1816939292" CREATED="1767063135936" MODIFIED="1767063143637">
<node TEXT="Movies with 1 or 2 Actors&#xa;Return the movies that have one or two actors, return movie title, the year the movie was released and the actors for the movie&#xa;Answer: 139" ID="ID_15081800" CREATED="1767077810685" MODIFIED="1767077875105">
<node TEXT="MATCH (a:Actor)-[:ACTED_IN]-&gt;(m:Movie)&#xa;WITH m, collect(a) AS Actors&#xa;WHERE size(Actors) = 1 OR size(Actors) = 2&#xa;RETURN m.title AS Title, m.released AS ReleasedYear, Actors" ID="ID_564303594" CREATED="1767077811565" MODIFIED="1767077814081"/>
</node>
</node>
<node TEXT="1.3 Using Aggregation to Count" ID="ID_411478847" CREATED="1767063143808" MODIFIED="1767063151188">
<node TEXT="count() function performs a count of properties, nodes, relationships, paths, or rows during query processing." ID="ID_998802559" CREATED="1767077897083" MODIFIED="1767077931551">
<node TEXT="count(*) returns the number of rows retrieved in the query" ID="ID_749278782" CREATED="1767078114502" MODIFIED="1767078129674"/>
</node>
<node TEXT="Count the movie titles that have been rated" ID="ID_39432412" CREATED="1767079565915" MODIFIED="1767079581050">
<node TEXT="MATCH (u:User)-[:RATED]-&gt;(m:Movie)&#xa;RETURN count(DISTINCT m.title)" ID="ID_1944686335" CREATED="1767079581055" MODIFIED="1767079608910"/>
</node>
</node>
<node TEXT="1.4 Counting Nodes - count()" ID="ID_306110535" CREATED="1767063164223" MODIFIED="1767063498126">
<node TEXT="Write a query return the number of actors who acted in a Comedy movie.&#xa;Answer: 6666" ID="ID_1653581978" CREATED="1767079778585" MODIFIED="1767079806105">
<node TEXT="MATCH (a:Actor)-[:ACTED_IN]-&gt;(m:Movie)-[:IN_GENRE]-&gt;(g:Genre {name: &quot;Comedy&quot;})&#xa;RETURN count(DISTINCT a)" ID="ID_263937745" CREATED="1767079806109" MODIFIED="1767079813389"/>
</node>
</node>
<node TEXT="1.5 Using Pattern Comprehension" ID="ID_588896211" CREATED="1767063169648" MODIFIED="1767063179650">
<node TEXT="Pattern comprehension in Cypher enables you to create a list based upon values obtained during a query. It&apos;s implemented in Cypher as a subquery." ID="ID_301373564" CREATED="1767079843913" MODIFIED="1767079888445"/>
<node TEXT="Using Cypher&apos;s pattern comprehension syntax: [&lt;pattern&gt; | value], we dynamically return a lit using values obtained from the pattern." ID="ID_1297479650" CREATED="1767080358296" MODIFIED="1767080395722"/>
<node TEXT="In some cases, pattern comprehension performs better than using collect() because it uses a subquery." ID="ID_1860793088" CREATED="1767080400358" MODIFIED="1767080422905">
<node TEXT="A benefit of pattern comprehension is that you don&apos;t need to have a collect() stage and you avoid potential cartesian products." ID="ID_642931760" CREATED="1767080601958" MODIFIED="1767080632616"/>
</node>
</node>
<node TEXT="1.6 Younger Actors" ID="ID_239745448" CREATED="1767063179791" MODIFIED="1767063187441">
<node TEXT="PROFILE&#xa;MATCH (a:Actor)&#xa;WHERE a.born.year &gt;= 1980&#xa;// leave off the Movie label to get better performance&#xa;WITH a, [(a)-[:ACTED_IN]-&gt;(m) WHERE 2000 &lt;= m.year &lt;= 2005 | m.title] AS Movies&#xa;WHERE size(Movies) &gt; 0&#xa;RETURN a.name as Actor, a.born as Born, Movies&#xa;&#xa;Answer: 55623" ID="ID_1479515148" CREATED="1767082397426" MODIFIED="1767082416020"/>
</node>
</node>
<node TEXT="2. Working with Lists" POSITION="bottom_or_right" ID="ID_884646455" CREATED="1767063119647" MODIFIED="1767063123203">
<node TEXT="2.01 Scalar List Functions" ID="ID_7515883" CREATED="1767063193231" MODIFIED="1767063205617">
<node TEXT="Size of a list: size()" ID="ID_610413821" CREATED="1767407377397" MODIFIED="1767407389033">
<node TEXT="Return the names of actors who acted in more than 20 movies by creating the list for each other, and then filtering the list by the size:" ID="ID_160555256" CREATED="1767406638216" MODIFIED="1767406684031">
<node TEXT="MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)&#xa;WITH p, collect (m.title) AS MovieTitles&#xa;WITH p, MovieTitles, size(MovieTitles) AS NumMovies&#xa;WHERE NumMovies &gt;= 20&#xa;RETURN p.name AS Actor, NumMovies, MovieTitles ORDER BY NumMovies" ID="ID_1701596543" CREATED="1767406684038" MODIFIED="1767406690747"/>
</node>
</node>
<node TEXT="First/Last element of a list" ID="ID_1881419558" CREATED="1767407393582" MODIFIED="1767407405727">
<node TEXT="Retrieve all movies for the year 2000 and adds them to a list, ordered by released property, then find the first element of the list of node" POSITION="bottom_or_right" ID="ID_963242553" CREATED="1767406928536" MODIFIED="1767406973830">
<node TEXT="MATCH (m:Movie)&#xa;WHERE  date(m.released).year = 2000&#xa;WITH m ORDER BY date(m.released)&#xa;WITH collect(m) AS Movies&#xa;WITH head(Movies) as First&#xa;RETURN First.title AS FirstTitle, First.released AS FirstDate" ID="ID_1892277596" CREATED="1767406973835" MODIFIED="1767406982585"/>
</node>
<node TEXT="Use &quot;last()&quot; to return the last element of a list." POSITION="bottom_or_right" ID="ID_860695350" CREATED="1767407002246" MODIFIED="1767407026521"/>
</node>
<node TEXT="Using reduce()" ID="ID_1985778824" CREATED="1767407416157" MODIFIED="1767407420713">
<node TEXT="Retrieve all movie revenue values from movies released in 2000 and creates the Revenues list, then use reduce() with a starting value of 0, adds each elements to return the total of all elements in the list" POSITION="bottom_or_right" ID="ID_74290725" CREATED="1767407292085" MODIFIED="1767407361245">
<node TEXT="MATCH (m:Movie) WHERE date(m.released).year = 2000&#xa;WITH collect(m.revenue) AS Revenues&#xa;WITH Revenues, reduce(t=0, r IN Revenues | t + r) AS TotalRevenue&#xa;RETURN TotalRevenue, size(Revenues) AS TotalMovies" ID="ID_619805975" CREATED="1767407361250" MODIFIED="1767407369838"/>
</node>
<node TEXT="Totaling the ratings for the movie, Toy Story and then returning the average by dividing by the size of the list" POSITION="bottom_or_right" ID="ID_945956781" CREATED="1767407442493" MODIFIED="1767407472202">
<node TEXT="MATCH (u:User)-[r:RATED]-&gt;(m:Movie)&#xa;WHERE m.title = &quot;Toy Story&quot;&#xa;WITH collect(r.rating) as Ratings&#xa;WITH Ratings, reduce(t=0, r in Ratings | t + r) AS TotalRatings&#xa;RETURN (round(TotalRatings / size(Ratings),1)) AS AverageRating" ID="ID_1671945667" CREATED="1767407747261" MODIFIED="1767407750672"/>
</node>
<node TEXT="Flatten a list of lists" POSITION="bottom_or_right" ID="ID_967042202" CREATED="1767407773701" MODIFIED="1767407780902">
<node TEXT="WITH [[1,2,3], [4,5,6], [7,8,9]] AS StartingList&#xa;RETURN reduce(Calc = [], r IN StartingList | Calc + r) AS FlattenedList" ID="ID_611497885" CREATED="1767407780906" MODIFIED="1767407787633"/>
</node>
<node TEXT="Retrieve total budget number for all movies that Martin Scorsese directed" POSITION="bottom_or_right" ID="ID_878603704" CREATED="1767408017677" MODIFIED="1767408040820">
<node TEXT="MATCH (d:Director)-[:DIRECTED]-&gt;(m:Movie)&#xa;WHERE d.name = &quot;Martin Scorsese&quot;&#xa;WITH collect(m.budget) AS Budgets&#xa;WITH Budgets, reduce(t = 0, b IN Budgets | t + b) AS TotalBudget&#xa;RETURN TotalBudget, size(Budgets) AS TotalMovies" ID="ID_1892339452" CREATED="1767408040825" MODIFIED="1767408056997"/>
</node>
</node>
</node>
<node TEXT="2.02 Oldest Actor" ID="ID_1980421756" CREATED="1767063205761" MODIFIED="1767063211775">
<node TEXT="Retrieve the actors who acted in movies in 2000 and who have a value for the born property" ID="ID_1499104046" CREATED="1767408106373" MODIFIED="1767408132326">
<node TEXT="MATCH (a:Actor)-[:ACTED_IN]-&gt;(m:Movie)&#xa;WHERE m.year = 2000 AND a.born IS NOT NULL&#xa;RETURN DISTINCT a.name AS Actor, a.born AS Born" ID="ID_1576403290" CREATED="1767408210093" MODIFIED="1767408213174"/>
</node>
<node TEXT="Find the Oldest Actor:&#xa;1) Sort the actors by the born property&#xa;2) Create a lit from the sorted actor nodes&#xa;3) Return the name and birth date of the oldest actor" ID="ID_39405694" CREATED="1767408222445" MODIFIED="1767408277381">
<node TEXT="MATCH (a:Actor)-[:ACTED_IN]-&gt;(m:Movie)&#xa;WHERE m.year = 2000 AND a.born IS NOT NULL&#xa;WITH a ORDER BY a.born&#xa;WITH collect(a) AS Actors&#xa;WITH head(Actors) as Oldest&#xa;RETURN Oldest.name AS OldestActor, Oldest.born AS OldestBorn" ID="ID_280632831" CREATED="1767408507474" MODIFIED="1767408509951"/>
<node TEXT="Answer: &quot;Ossie Davis&quot;, 1917-12-18" ID="ID_1593059313" CREATED="1767408511113" MODIFIED="1767408524109"/>
</node>
</node>
<node TEXT="2.03 Total imdbVotes for Tom Hanks" ID="ID_1796447946" CREATED="1767063211934" MODIFIED="1767063230689">
<node TEXT="Using reduce() to return the total of all imdbVotes for movies that Tom Hanks acted in" ID="ID_1064080150" CREATED="1767408773535" MODIFIED="1767408809830">
<node TEXT="MATCH (a:Actor {name:&quot;Tom Hanks&quot;})-[:ACTED_IN]-&gt;(m:Movie)&#xa;WITH collect(m.imdbVotes) AS Votes&#xa;WITH Votes, reduce(t=0, v IN Votes | t + v) AS TotalVotes&#xa;RETURN TotalVotes" ID="ID_1468270714" CREATED="1767408823301" MODIFIED="1767408831193"/>
<node TEXT="Answer 7836629" ID="ID_1956665215" CREATED="1767408809833" MODIFIED="1767408820520"/>
</node>
</node>
<node TEXT="2.04 Functions that Return Lists" ID="ID_714867403" CREATED="1767063230848" MODIFIED="1767063237217">
<node TEXT="Using range()" ID="ID_1335843414" CREATED="1767411824499" MODIFIED="1767411830966">
<node TEXT="Generating a range list is useful when creating nodes with an ID" ID="ID_1298953807" CREATED="1767411980274" MODIFIED="1767411999652"/>
<node TEXT="Use value 1 to 100 to create Order nodes" ID="ID_1794531320" CREATED="1767411956049" MODIFIED="1767411968945">
<node TEXT="UNWIND range(1,100) AS i&#xa;MERGE (:Order {id: i})" ID="ID_520019732" CREATED="1767411968948" MODIFIED="1767411975823"/>
</node>
</node>
<node TEXT="Reversing the elements of a list: reverse()" ID="ID_374250283" CREATED="1767412003419" MODIFIED="1767412037613">
<node TEXT="MATCH (a:Actor)--(m:Movie)&#xa;WHERE m.year &lt; 1910&#xa;WITH a, count (m) AS NumMovies&#xa;WITH NumMovies, [a.name, NumMovies] AS Stats ORDER BY NumMovies&#xa;WITH collect(Stats) as AllStats&#xa;return AllStats, reverse(AllStats)" ID="ID_500449234" CREATED="1767412150178" MODIFIED="1767412152995">
<node TEXT="AllStats" ID="ID_1551824453" CREATED="1767431432042" MODIFIED="1767431437627">
<node TEXT="[[&quot;Henri Delannoy&quot;, 1], [&quot;François Lallement&quot;, 1], [&quot;Jules-Eugène Legris&quot;, 1], [&quot;Georges Méliès&quot;, 2]]" ID="ID_533927328" CREATED="1767431446946" MODIFIED="1767431450069"/>
</node>
<node TEXT="reverse(AllStats)" ID="ID_1586328316" CREATED="1767431438073" MODIFIED="1767431445686">
<node TEXT="[[&quot;Georges Méliès&quot;, 2], [&quot;Jules-Eugène Legris&quot;, 1], [&quot;François Lallement&quot;, 1], [&quot;Henri Delannoy&quot;, 1]]" ID="ID_1248382409" CREATED="1767431454552" MODIFIED="1767431458942"/>
</node>
</node>
</node>
<node TEXT="Returning all but the first element of a list" ID="ID_1146004493" CREATED="1767433413923" MODIFIED="1767433424597">
<node TEXT="MATCH (m:Movie)&#xa;WHERE date(m.released).year = 2000&#xa;WITH m ORDER BY date(m.released)&#xa;WITH collect(m) AS Movies&#xa;RETURN head(Movies).title AS FirstTitle, head(Movies).released AS FirstDate, size(tail(Movies)) AS SizeOfTail,&#xa;tail(Movies)[-1].title AS LastTitle, tail(Movies)[-1].released AS LastDate,&#xa;last(Movies).title AS LastTitle1, last(Movies).released AS LastDate1" ID="ID_1698428771" CREATED="1767433715941" MODIFIED="1767433719704"/>
<node TEXT="tail()[-1] is same result as last()" ID="ID_916142872" CREATED="1767437817448" MODIFIED="1767437840922"/>
</node>
<node TEXT="Using split() to create a list form a string" ID="ID_1557842964" CREATED="1767437844527" MODIFIED="1767437855908">
<node TEXT="LOAD CSV WITH HEADERS FROM &apos;https://data.neo4j.com/importing/MovieDataUnclean.csv&apos; AS row&#xa;WITH row.title AS Title, row.languages AS Field, split(row.languages, &quot;|&quot;) AS FieldList&#xa;RETURN Title, Field, FieldList" ID="ID_271550680" CREATED="1767438297036" MODIFIED="1767438301968"/>
</node>
<node TEXT="Creating a List of Nodes, nodes()" ID="ID_296711567" CREATED="1767438312900" MODIFIED="1767438327288">
<node TEXT="nodes() returns all nodes in the path, then only extract in the nodes with the Movie lable" ID="ID_806304685" CREATED="1767441039101" MODIFIED="1767441069808">
<node TEXT="MATCH path = (p:Person {name: &apos;Elvis Presley&apos;})-[r*4]-(a:Actor)&#xa;WITH nodes(path) AS n&#xa;UNWIND n AS x&#xa;WITH x WHERE x:Movie&#xa;RETURN DISTINCT x.title" ID="ID_1898892580" CREATED="1767441031276" MODIFIED="1767441034207"/>
</node>
<node TEXT="Get nodes that are up to 6 hops away from the Movie &quot;Toy Story&quot;, check to make sure that the name property in the node is not null since the node label could be a Movie, and we only interested in Person nodes that have a name property, then return the name of the last node in the list and its distance from the Toy Story node." ID="ID_1520907403" CREATED="1767441278665" MODIFIED="1767441375954">
<node TEXT="MATCH (m:Movie {title: &quot;Toy Story&quot;})&#xa;MATCH path = (m)-[:ACTED_IN*1..6]-()&#xa;WHERE last(nodes(path)).name IS NOT NULL&#xa;RETURN last(nodes(path)).name AS LastNode, length(path) AS HopsAway&#xa;ORDER BY HopsAway DESC" ID="ID_360693400" CREATED="1767441278840" MODIFIED="1767441282292"/>
</node>
</node>
</node>
<node TEXT="2.05 Latest Movie Review" ID="ID_822847681" CREATED="1767063237376" MODIFIED="1767063243554">
<node TEXT="Return a list pertaining to the movie &quot;Toy Story&quot;, the list will contain the timestamp of when the movie review was done (from the RATING) relationship) and the name of the review, then result is the last person to review the movie." ID="ID_1342610551" CREATED="1767442147646" MODIFIED="1767442236230">
<node TEXT="MATCH (m:Movie {title: &apos;Toy Story&apos;})&#xa;MATCH (u:User)-[r:RATED]-&gt;(m)&#xa;ORDER BY r.timestamp&#xa;WITH collect([u.name, r.timestamp]) AS UserRatings&#xa;RETURN last(UserRatings)[0]" ID="ID_651993824" CREATED="1767442236236" MODIFIED="1767442257304"/>
<node TEXT="Answer: &quot;Catherine Trujillo&quot;" ID="ID_1637028279" CREATED="1767442240332" MODIFIED="1767442244692"/>
</node>
</node>
<node TEXT="2.06 Reviewed Same Movies" ID="ID_1840672637" CREATED="1767063243744" MODIFIED="1767063251346">
<node TEXT="MATCH path = (u:User {name: &apos;Catherine Trujillo&apos;})-[:RATED*2]-()&#xa;WITH nodes(path) AS n&#xa;UNWIND n AS x&#xa;WITH x WHERE x:User AND x.name &lt;&gt; &apos;Catherine Trujillo&apos;&#xa;RETURN count(DISTINCT x.name) AS OtherUsers" ID="ID_1117009231" CREATED="1767442854959" MODIFIED="1767442857378"/>
<node TEXT="Answer: 646" ID="ID_1545913495" CREATED="1767442858680" MODIFIED="1767442866355"/>
</node>
<node TEXT="2.07 Functions to Transform Element Types" ID="ID_997021319" CREATED="1767063251503" MODIFIED="1767063261983">
<node TEXT="toStringList(): transform elements to Strings" ID="ID_840003145" CREATED="1767443268004" MODIFIED="1767443436670">
<node TEXT="WITH [&apos;abc&apos;, False, 1, 1.5, null, datetime(), date(), LocalDateTime(), point({x:2.3, y:4.5})] AS MyList&#xa;RETURN toStringList(MyList)" ID="ID_1992644659" CREATED="1767443400964" MODIFIED="1767443403460"/>
<node TEXT="Result:&#xa;[&quot;abc&quot;, &quot;false&quot;, &quot;1&quot;, &quot;1.5&quot;, null, &quot;2026-01-03T12:29:50.922Z&quot;, &quot;2026-01-03&quot;, &quot;2026-01-03T12:29:50.922&quot;, &quot;point({x: 2.3, y: 4.5, crs: &apos;cartesian&apos;})&quot;]" ID="ID_640896617" CREATED="1767443404564" MODIFIED="1767443425989"/>
<node TEXT="The only exception for this function is that null elements will remain null in the target list" ID="ID_1135292885" CREATED="1767443446707" MODIFIED="1767443475822"/>
</node>
<node TEXT="toIntegerList(): produces elements of type Long (known as Integer)" ID="ID_1250272344" CREATED="1767443476794" MODIFIED="1767444042481">
<node TEXT="WITH [&apos;abc&apos;, False, 1, 1.5, null, datetime(), date(), LocalDateTime(), point({x:2.3, y:4.5})] AS MyList&#xa;RETURN toIntegerList(MyList)" ID="ID_3704341" CREATED="1767444070975" MODIFIED="1767444074986"/>
<node TEXT="Result:&#xa;[null, 0, 1, 1, null, null, null, null, null]" ID="ID_1928709654" CREATED="1767444089760" MODIFIED="1767444095089"/>
<node TEXT="Only numeric and Boolean type elements will be transformed." ID="ID_1932180726" CREATED="1767444095479" MODIFIED="1767444116107"/>
</node>
<node TEXT="toFloatList(): produces elements of type Float" ID="ID_223120706" CREATED="1767444124032" MODIFIED="1767444138039">
<node TEXT="WITH [&apos;abc&apos;, False, 1, 1.5, null, datetime(), date(), LocalDateTime(), point({x:2.3, y:4.5})] AS MyList&#xa;RETURN toFloatList(MyList)" ID="ID_999709740" CREATED="1767444138043" MODIFIED="1767444152426"/>
<node TEXT="Result:&#xa;[null, null, 1.0, 1.5, null, null, null, null, null]" ID="ID_1808646871" CREATED="1767444152863" MODIFIED="1767444167569"/>
<node TEXT="Only numeric type elements will be transformed." ID="ID_353288975" CREATED="1767444167887" MODIFIED="1767444179162"/>
</node>
<node TEXT="toBooleanList(): produces elements of type Boolean" ID="ID_870763620" CREATED="1767444216686" MODIFIED="1767444232559">
<node TEXT="WITH [&apos;abc&apos;, False, 1, 1.5, null, datetime(), date(), LocalDateTime(), point({x:2.3, y:4.5})] AS MyList&#xa;RETURN toBooleanList(MyList)" ID="ID_1269277510" CREATED="1767444232563" MODIFIED="1767444254089"/>
<node TEXT="Result:&#xa;[null, false, true, null, null, null, null, null, null]" ID="ID_1016965677" CREATED="1767444297486" MODIFIED="1767444301672"/>
</node>
</node>
<node TEXT="2.08 Update Movie Reviews" ID="ID_1871230436" CREATED="1767063262143" MODIFIED="1767063268466">
<node TEXT="Return a list pertaining to the movie, Toy Story, contain the rating value for the RATED relationships for the movie with the title, Toy Story, then transform the value to integers." ID="ID_1943300466" CREATED="1767444381158" MODIFIED="1767444435741">
<node TEXT="MATCH ()-[r:RATED]-(m:Movie {title:&apos;Toy Story&apos;})&#xa;WITH collect(r.rating) AS Ratings&#xa;WITH Ratings, toIntegerList(Ratings) AS RatingsInteger&#xa;UNWIND RatingsInteger AS NewRatings&#xa;WITH NewRatings WHERE NewRatings = 4&#xa;RETURN count(NewRatings)" ID="ID_1954204533" CREATED="1767444435748" MODIFIED="1767445281097"/>
<node TEXT="Result: 96" ID="ID_157195801" CREATED="1767445281303" MODIFIED="1767445284226"/>
<node TEXT="MATCH ()-[r:RATED]-(m:Movie {title:&apos;Toy Story&apos;})&#xa;WITH collect(r.rating) AS Ratings&#xa;WITH Ratings, toIntegerList(Ratings) AS RatingsInteger&#xa;RETURN size([x in RatingsInteger WHERE x = 4 | x]) AS Count4" ID="ID_1388553131" CREATED="1767447757342" MODIFIED="1767447764351"/>
</node>
</node>
<node TEXT="2.09 Testing Lists with Predicate Functions" FOLDED="true" ID="ID_1604442509" CREATED="1767063268623" MODIFIED="1767063276142">
<node TEXT="Test if All elements satisfy the criteria: all()" ID="ID_287423643" CREATED="1767445715743" MODIFIED="1767445738268">
<node TEXT="The test here for the list of nodes in the path is whether the year property is greater than 1900 (for a movie node) or whether the node type is an Actor. If this test evaluates to true, then the path is returned." ID="ID_1370157392" CREATED="1767445940556" MODIFIED="1767445943326">
<node TEXT="MATCH p = (a:Actor {name:&apos;Meg Ryan&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE all(x IN nodes(p) WHERE x.year &gt; 1900 OR x:Actor)&#xa;RETURN p" ID="ID_1905517183" CREATED="1767445943332" MODIFIED="1767445951801"/>
</node>
<node TEXT="Test the paths from Meg Ryan to other actors for movies that wee released in 2000." ID="ID_1076058916" CREATED="1767446888906" MODIFIED="1767446945565">
<node TEXT="MATCH p = (a:Actor {name:&apos;Meg Ryan&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE all(x IN nodes(p) WHERE date(x.released).year=2000 OR x:Actor)&#xa;RETURN p" ID="ID_393677803" CREATED="1767446892106" MODIFIED="1767446895542"/>
</node>
</node>
<node TEXT="Test if one or more elements satisfy the criteria: any()" ID="ID_665272112" CREATED="1767446048211" MODIFIED="1767446104877">
<node TEXT="Query returns the paths from Mag Ryan to other actors for movies released in the year 2000" ID="ID_1364751284" CREATED="1767446136858" MODIFIED="1767446204561">
<node TEXT="MATCH p = (a:Actor {name:&apos;Meg Ryan&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE any(x IN nodes(p) WHERE x.year = 2000 )&#xa;RETURN p" ID="ID_1986655808" CREATED="1767446204566" MODIFIED="1767446215564"/>
<node TEXT="Result: 2 movies" ID="ID_714273161" CREATED="1767446216474" MODIFIED="1767446222898"/>
</node>
</node>
<node TEXT="Test if a list is empty: isEmpty()" ID="ID_1727685497" CREATED="1767446064842" MODIFIED="1767446234855">
<node TEXT="Returns true is the list is empty" ID="ID_1436002671" CREATED="1767446307239" MODIFIED="1767446319578">
<node TEXT="MATCH (m:Movie)&#xa;WITH collect(m.title) AS Movies&#xa;RETURN isEmpty(Movies)" ID="ID_301182842" CREATED="1767446319582" MODIFIED="1767446324180"/>
</node>
<node TEXT="Same result" ID="ID_714503113" CREATED="1767446325048" MODIFIED="1767446329617">
<node TEXT="MATCH (m:Movie)&#xa;WITH collect(m.title) AS Movies&#xa;RETURN size(Movies) = 0" ID="ID_1539932220" CREATED="1767446329621" MODIFIED="1767446335517"/>
</node>
</node>
<node TEXT="Test if no elements in a list satisfy the criteria: none()" ID="ID_715244924" CREATED="1767446070763" MODIFIED="1767446344000">
<node TEXT="Return true if none of the elements satisfy the criteria" ID="ID_519983249" CREATED="1767446344002" MODIFIED="1767446371823">
<node TEXT="MATCH p = (a:Actor {name:&apos;Meg Ryan&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE none(x IN nodes(p) WHERE x.name = &apos;Tom Hanks&apos; and x:Actor)&#xa;RETURN p" ID="ID_1084810405" CREATED="1767446371828" MODIFIED="1767446425147"/>
<node TEXT="This query will return all paths that do not include both Meg Ryan and Tom Hanks. We test whether Tom Hanks is in the path and if he is not, then the path is returned. If you were to run this query where you comment out the AND clause, you will see that more paths are returned." ID="ID_1295844313" CREATED="1767446434510" MODIFIED="1767446437073"/>
</node>
</node>
<node TEXT="Test if at most a single element satisfy the criteria: single()" ID="ID_1424574753" CREATED="1767446081435" MODIFIED="1767446446147">
<node TEXT="MATCH p = (a:Actor {name:&apos;Tom Hanks&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE single(x IN nodes(p) WHERE x.born.year = a.born.year and x:Actor)&#xa;RETURN a.name, a.born.year, a2.name, a2.born.year" ID="ID_1981107569" CREATED="1767446690251" MODIFIED="1767446694281"/>
</node>
</node>
<node TEXT="2.10 Tom Hanks Movies in 1995" ID="ID_1365682223" CREATED="1767063276271" MODIFIED="1767063285665">
<node TEXT="Query to return the paths to other actors from Tom Hanks where the movie was released in 1995, how many path?" ID="ID_798934647" CREATED="1767446979042" MODIFIED="1767447013306">
<node TEXT="MATCH p = (a:Actor {name:&apos;Tom Hanks&apos;})-[:ACTED_IN*2]-(a2:Actor)&#xa;WHERE all(x IN nodes(p) WHERE x.year=1995 OR x:Actor)&#xa;RETURN count(p)" ID="ID_13422405" CREATED="1767447013312" MODIFIED="1767447074957"/>
<node TEXT="Answer: 6" ID="ID_291039912" CREATED="1767447075402" MODIFIED="1767447078363"/>
</node>
</node>
<node TEXT="2.11 Using List Comprehension to Aggregate" ID="ID_1906330713" CREATED="1767063285805" MODIFIED="1767063295037">
<node TEXT="List comprehension enables you to extract values from an existing list." ID="ID_955046017" CREATED="1767447112152" MODIFIED="1767447767955">
<arrowlink DESTINATION="ID_1388553131"/>
<node TEXT="you can create a list by evaluating an expression that tests for list inclusion." ID="ID_539293405" CREATED="1767447145528" MODIFIED="1767447164852"/>
<node TEXT="you can modify the values returned in the list" ID="ID_1272588106" CREATED="1767447165376" MODIFIED="1767447187849"/>
</node>
<node TEXT="Return a subset of the list where the values in the countries list property are either USA or Germany or both:" ID="ID_1032309192" CREATED="1767447815131" MODIFIED="1767447853212">
<node TEXT="MATCH (m:Movie)&#xa;RETURN m.title AS MovieTitle,&#xa;[x IN m.countries WHERE x CONTAINS &apos;USA&apos; OR x CONTAINS &apos;Germany&apos;| x] AS COUNTRY" ID="ID_68520657" CREATED="1767447853215" MODIFIED="1767447868103"/>
</node>
<node TEXT="Modify the values that are returned in the list:" ID="ID_799972374" CREATED="1767447880866" MODIFIED="1767447890179">
<node TEXT="MATCH (m:Movie)-[:ACTED_IN]-(a:Actor)&#xa;WHERE toLower(a.name) = &apos;tom hanks&apos;&#xa;WITH m ORDER BY m.released DESC&#xa;WITH collect(m) AS Movies&#xa;WITH [x IN Movies | x.title + &quot;: &quot; + toString(date().year-x.year+1)] AS Summary&#xa;UNWIND Summary as MovieAge&#xa;RETURN MovieAge" ID="ID_307691663" CREATED="1767447890181" MODIFIED="1767448122422"/>
</node>
<node TEXT="return the list of titles and release dates for the movies of an actor. Each row returned will contain the name of the actor and a list containing the title and release date for a movie. The title and release date element will be of the format &quot;title: release date&quot;. Use the dropdown below to select the correct code to complete this query." ID="ID_1256081240" CREATED="1767448403403" MODIFIED="1767448417802">
<node TEXT="MATCH (a:Actor)--(m:Movie)&#xa;WITH a, collect(m) AS Movies&#xa;RETURN a.name AS Actor, size(Movies) as NumMovies,&#xa;[x in Movies | x.title + &quot;: &quot; + toString(x.released)] AS TitleRelease&#xa;LIMIT 100" ID="ID_1804683702" CREATED="1767448405104" MODIFIED="1767448407580"/>
</node>
</node>
<node TEXT="2.12 Ages of Actors in Movies" ID="ID_1237566006" CREATED="1767063295165" MODIFIED="1767063305393">
<node TEXT="return a list containing the ages of the actors for the Movie Toy Story. The age you return is the age of the actor when the movie was released.&#xa;&#xa;What is the age at the time the movie was released of the oldest actor who acted in this movie?" ID="ID_1041736707" CREATED="1767448441632" MODIFIED="1767448444144">
<node TEXT="MATCH (a:Actor)-[:ACTED_IN]-&gt;(m:Movie {title:&apos;Toy Story&apos;})&#xa;WITH a, m, collect(a.born.year) AS ActorBornYear&#xa;RETURN a.name, [x in ActorBornYear | m.year - x] AS ActorAge&#xa;ORDER BY ActorAge DESC" ID="ID_635936994" CREATED="1767448444150" MODIFIED="1767448720475"/>
<node TEXT="Answer: &quot;Don Rickles&quot;, [69]" ID="ID_338253390" CREATED="1767448720895" MODIFIED="1767448738186"/>
</node>
</node>
</node>
<node TEXT="3. Aggregating Functions" POSITION="bottom_or_right" ID="ID_932771011" CREATED="1767063123361" MODIFIED="1767063129811">
<node TEXT="3.1 Adding Values - sum()" ID="ID_242931258" CREATED="1767063311644" MODIFIED="1767063462851">
<node TEXT="Using sum() to add values" ID="ID_1489727582" CREATED="1767449029246" MODIFIED="1767449035186">
<node TEXT="PROFILE MATCH (m:Movie)&#xa;WHERE m.year = 2000&#xa;RETURN sum(m.revenue) as GrossRevenue" ID="ID_1008223388" CREATED="1767449040430" MODIFIED="1767449043154"/>
<node TEXT="In this query, the value returned is of type float since at least one of the values being totaled is of type float:" FOLDED="true" ID="ID_1407387005" CREATED="1767449077669" MODIFIED="1767449079783">
<node TEXT="WITH [1, 1.5,2] as Nums&#xa;UNWIND Nums AS  x&#xa;RETURN sum(x)" POSITION="bottom_or_right" ID="ID_1464886343" CREATED="1767449046766" MODIFIED="1767449049295"/>
</node>
<node TEXT="retrieve the number of movies Toy Story has in common with each genre name. For each movie we aggregate to create a total for the imdbRating for each movie. Then we return the genre name, the number of movies in common, and the average score. Here we determine the average by dividing the sum by the number of movies. You will learn about the Cypher avg() function in the next lesson." ID="ID_959567252" CREATED="1767449321595" MODIFIED="1767449345838">
<node TEXT="MATCH (:Movie {title:&apos;Toy Story&apos;})-[:IN_GENRE]-&gt;(g:Genre)&lt;-[:IN_GENRE]-(m:Movie)&#xa;WHERE m.imdbRating IS NOT NULL&#xa;WITH g.name AS Genre, count(m) AS MoviesInCommon, sum(m.imdbRating) AS Total&#xa;RETURN Genre, MoviesInCommon, Total/MoviesInCommon AS Score&#xa;ORDER BY Score DESC" ID="ID_1367089307" CREATED="1767449324147" MODIFIED="1767449327531"/>
</node>
</node>
<node TEXT="Use sum() for durations" ID="ID_1304894082" CREATED="1767449361355" MODIFIED="1767449369831">
<node TEXT="retrieve all Actor nodes with a name that begins with &quot;Tom&quot;. We collect the durations between the birth date and now. We then UNWIND the list of durations to aggreate the values using sum(). We return the sum, but we can also use the calcuated sum to return the average age." ID="ID_575947274" CREATED="1767449390289" MODIFIED="1767449394831">
<node TEXT="MATCH (a:Actor)&#xa;WHERE&#xa;a.born IS NOT NULL&#xa;AND a.name STARTS WITH &apos;Tom&apos;&#xa;WITH count(a) AS NumActors, collect(duration.between(date(a.born), date())) AS Ages&#xa;UNWIND Ages AS x&#xa;WITH NumActors, sum(x) AS TotalAges&#xa;RETURN  TotalAges, TotalAges/NumActors" ID="ID_979906667" CREATED="1767451596479" MODIFIED="1767451599914"/>
</node>
</node>
</node>
<node TEXT="3.2 Years Since Movie Reviewed" ID="ID_200375611" CREATED="1767063318173" MODIFIED="1767063327952">
<node TEXT="Calculate the average number of years between the release of a movie and when it was reviewed, answer what is average time in years between the release date and when the movie was reviewed by Angela Thompson." ID="ID_1975117989" CREATED="1767486502765" MODIFIED="1767487266040">
<node TEXT="MATCH (u:User {name:&apos;Angela Thompson&apos;})-[r:RATED]-&gt;(m:Movie)&#xa;RETURN sum(datetime({epochSeconds:r.timestamp}).year - m.year) / count(m)" ID="ID_1504065695" CREATED="1767487266043" MODIFIED="1767487268665"/>
<node TEXT="Answer: 14" ID="ID_376658498" CREATED="1767487269175" MODIFIED="1767487272042"/>
<node TEXT="MATCH (u:User {name:&apos;Angela Thompson&apos;})-[r:RATED]-&gt;(m:Movie)&#xa;WITH count(m) as NumMovies, collect(duration.between(datetime({epochseconds:r.timestamp}), date(m.released))) AS ReviewPeriods&#xa;UNWIND ReviewPeriods AS x&#xa;WITH NumMovies, sum(x) AS TotalReviewPeriod&#xa;RETURN TotalReviewPeriod / NumMovies / 12" ID="ID_1935295463" CREATED="1767488245905" MODIFIED="1767488250609">
<node TEXT="Result: P-14M-3DT-54469.754901958S" ID="ID_375008117" CREATED="1767488263760" MODIFIED="1767488275972"/>
<node TEXT="question: cannot show 14 year directly" ID="ID_981685368" CREATED="1767488250615" MODIFIED="1767488261412"/>
</node>
</node>
</node>
<node TEXT="3.3 Averaging Values - avg() / stddev()" ID="ID_65897062" CREATED="1767063328125" MODIFIED="1767063477086">
<node TEXT="Using avg() to average values" ID="ID_639104303" CREATED="1767488296383" MODIFIED="1767488307747">
<node TEXT="PROFILE MATCH (m:Movie)&#xa;WHERE m.year = 2000&#xa;RETURN avg(m.revenue) as AvgRevenue" ID="ID_337390364" CREATED="1767488406942" MODIFIED="1767488409586"/>
<node TEXT="If the values used for avg() contain nulls, then that element is not used in the calculation." ID="ID_132902128" CREATED="1767488463500" MODIFIED="1767488466431">
<node TEXT="WITH [1,3, null] as Nums&#xa;UNWIND Nums AS x&#xa;RETURN avg(x)" ID="ID_404448004" CREATED="1767488632077" MODIFIED="1767488634911"/>
</node>
<node TEXT="The subquery returns 10 Movie nodes of movies released in 2000 with the highest imdbRating. Then with these 10 movies, it determines the average rating for each of these 10 movies." ID="ID_1848558954" CREATED="1767488613275" MODIFIED="1767488617375">
<node TEXT="CALL {&#xa;  MATCH (m:Movie {year:2000})&#xa;  RETURN m ORDER BY m.imdbRating DESC LIMIT 10&#xa;}&#xa;MATCH (:User)-[r:RATED]-&gt;(m)&#xa;RETURN m.title as Movie, avg(r.rating) AS AverageRating" POSITION="bottom_or_right" ID="ID_1628804951" CREATED="1767488591323" MODIFIED="1767488595087"/>
</node>
<node TEXT="return the average of the User ratings for all movies released in 2000" ID="ID_844057637" CREATED="1767489928049" MODIFIED="1767489931282">
<node TEXT="MATCH (u:User)-[r:RATED]-&gt;(m:Movie {year:2000})&#xa;RETURN avg(r.rating)" ID="ID_427932721" CREATED="1767489931289" MODIFIED="1767489938232"/>
</node>
</node>
<node TEXT="avg() and eager aggregation" ID="ID_1694397145" CREATED="1767488638954" MODIFIED="1767488646607">
<node TEXT="A best practice in a query is to aggregate early." ID="ID_771227827" CREATED="1767488679354" MODIFIED="1767488684370">
<node TEXT="PROFILE MATCH (m:Movie)&#xa;WITH avg(m.imdbVotes) as AverageVote&#xa;MATCH (m2:Movie)&#xa;WHERE m2.year = 2010 AND m2.imdbVotes &gt; AverageVote&#xa;RETURN AverageVote AS OverallAverageVote, m2.title AS Title , m2.imdbVotes AS AverageVote" ID="ID_1825780394" CREATED="1767488810922" MODIFIED="1767488813675">
<node TEXT="The call to avg() requires that all movie nodes are retrieved before the next step in the execution plan." ID="ID_305921581" CREATED="1767488813683" MODIFIED="1767488824206"/>
</node>
<node TEXT="MATCH (u:User {name: &quot;Misty Williams&quot;})-[r:RATED]-&gt;(:Movie)&#xa;WITH u, avg(r.rating) AS average&#xa;MATCH (u)-[r:RATED]-&gt;(m:Movie)&#xa;WHERE r.rating &gt; average&#xa;RETURN average , m.title AS movie,&#xa;r.rating as rating&#xa;ORDER BY rating DESC" ID="ID_1579559843" CREATED="1767488922857" MODIFIED="1767488926174">
<node TEXT="we first calculate the average rating for all movies that Misty Williams rated. Then we use this calculated value, Average as a test for the second MATCH." ID="ID_1351694618" CREATED="1767488959066" MODIFIED="1767488961422"/>
</node>
</node>
</node>
<node TEXT="Using avg() for durations" ID="ID_352034886" CREATED="1767488997546" MODIFIED="1767489005758">
<node TEXT="MATCH (a:Actor)&#xa;WHERE&#xa;a.born IS NOT NULL&#xa;AND a.name STARTS WITH &apos;Tom&apos;&#xa;WITH count(a) AS NumActors, collect(duration.between(date(a.born), date())) AS Ages&#xa;UNWIND Ages AS x&#xa;WITH  NumActors, sum(x) AS TotalAges, avg(x) AS AverageAge&#xa;RETURN  TotalAges, TotalAges/NumActors, AverageAge" ID="ID_1047385671" CREATED="1767489215851" MODIFIED="1767489218175">
<node TEXT="MATCH (a:Actor)&#xa;WHERE&#xa;a.born IS NOT NULL&#xa;AND a.name STARTS WITH &apos;Tom&apos;&#xa;WITH count(a) AS NumActors, collect(duration.between(date(a.born), date())) AS Ages&#xa;UNWIND Ages AS x&#xa;WITH  NumActors, sum(x) AS TotalAges, avg(x) AS AverageAge&#xa;RETURN  TotalAges.years, TotalAges.years/NumActors, AverageAge.years" ID="ID_1288514386" CREATED="1767489467042" MODIFIED="1767489469254"/>
</node>
<node TEXT="To Convert Duration to years:" ID="ID_203821300" CREATED="1767489410421" MODIFIED="1767489419555">
<node TEXT=" MATCH (a:Actor)&#xa; WHERE&#xa; a.born IS NOT NULL&#xa; AND a.name STARTS WITH &apos;Tom&apos;&#xa; WITH count(a) AS NumActors, collect(duration.between(date(a.born), date())) AS Ages&#xa; UNWIND Ages AS x&#xa; WITH NumActors,&#xa;      sum(x.years + x.months / 12.0 + x.days / 365.0) AS TotalAgesInYears,&#xa;      avg(x.years + x.months / 12.0 + x.days / 365.0) AS AverageAgeInYears&#xa; RETURN TotalAgesInYears, TotalAgesInYears/NumActors AS AverageAgeCalculated, AverageAgeInYears" ID="ID_615537470" CREATED="1767489419558" MODIFIED="1767489426086">
<node TEXT="x.years: The years component of the duration.&#xa;&#xa;x.months / 12.0: Converts months into years by dividing by 12.&#xa;&#xa;x.days / 365.0: Converts days into a year fraction by dividing by 365 (approximating a year as 365 days)." ID="ID_601313264" CREATED="1767489485459" MODIFIED="1767489489125"/>
</node>
</node>
</node>
<node TEXT="Calculating standard deviation" ID="ID_1342944682" CREATED="1767489501395" MODIFIED="1767489510137">
<node TEXT="stddev(): uses a sample of the values for an unbiased estimate" ID="ID_1562400483" CREATED="1767489519127" MODIFIED="1767489541365"/>
<node TEXT="stddevP(): uses the exact population of values so for accuracy, this function should be used" ID="ID_1117054456" CREATED="1767489541714" MODIFIED="1767489569780"/>
</node>
</node>
<node TEXT="3.4 Average Reviews per User" ID="ID_1447238987" CREATED="1767063334125" MODIFIED="1767063341425">
<node TEXT="Write a query to returns the average number of reviews of movies per user.&#xa;&#xa;What is average number of reviews for all users? (enter an integer number)" ID="ID_396067585" CREATED="1767490337807" MODIFIED="1767490345233">
<node TEXT="MATCH (u:User)-[r:RATED]-&gt;(m:Movie)&#xa;RETURN count(r)/count(DISTINCT u)" ID="ID_1696610470" CREATED="1767490345239" MODIFIED="1767490355412">
<node TEXT="Answer: 149&#xa;But not using Avg()" POSITION="bottom_or_right" ID="ID_916452076" CREATED="1767490355855" MODIFIED="1767490363939"/>
</node>
<node TEXT=" MATCH (u:User)-[r:RATED]-(m:Movie)&#xa; WITH u, count(r) AS NumReviews&#xa; WITH collect(NumReviews) AS ReviewCounts&#xa; UNWIND ReviewCounts AS x&#xa; RETURN toInteger(avg(x))" ID="ID_1139357844" CREATED="1767490407759" MODIFIED="1767490410739"/>
</node>
</node>
<node TEXT="3.5 Calculating Min/Max Values - min() / max()" ID="ID_118598952" CREATED="1767063341582" MODIFIED="1767063486939">
<node TEXT="Mixed element types" ID="ID_1942225145" CREATED="1767491166810" MODIFIED="1767491175965">
<node TEXT="A numeric value is always greater than a string or list value. This query returns 2 because it is the greatest numeric value." ID="ID_608557608" CREATED="1767491246426" MODIFIED="1767491248425">
<node TEXT="UNWIND [[2],0,&quot;a&quot;,2,[1]] AS x&#xa;RETURN max(x)" ID="ID_1447364993" CREATED="1767491248432" MODIFIED="1767491254077"/>
</node>
<node TEXT="String values are always greater than a list value. Because strings are always greater than lists, this query returns &quot;b&quot;" ID="ID_1408722202" CREATED="1767491263849" MODIFIED="1767491266666">
<node TEXT="UNWIND [[&quot;a&quot;],&quot;a&quot;,&quot;b&quot;,[1]] AS x&#xa;RETURN max(x)" ID="ID_1293017790" CREATED="1767491266672" MODIFIED="1767491288109"/>
</node>
</node>
<node TEXT="List element comparisons" ID="ID_417955341" CREATED="1767491292635" MODIFIED="1767491300014">
<node TEXT="If lists are being compared, the elements are compared in the order in the list. This query returns [1,3,5] because the element comparison of the second element is greatest and no other elements in the list are compared." POSITION="bottom_or_right" ID="ID_82915583" CREATED="1767490534927" MODIFIED="1767491357768">
<node TEXT="UNWIND [[1,2,12], [1,3,5]] AS x&#xa;RETURN max(x)" ID="ID_1881421153" CREATED="1767491357776" MODIFIED="1767491363689"/>
</node>
</node>
<node TEXT="Using min() / max() effectively" ID="ID_382814719" CREATED="1767491300200" MODIFIED="1767491311535">
<node TEXT="they&apos;re eager aggregation" ID="ID_831201443" CREATED="1767491581812" MODIFIED="1767491594580">
<node TEXT="MATCH (m:Movie)&#xa;WITH max(m.imdbVotes) AS TopVotes&#xa;MATCH (m:Movie) WHERE m.imdbVotes = TopVotes&#xa;RETURN m.title, m.imdbVotes, m.imdbRating" ID="ID_1005209799" CREATED="1767491594586" MODIFIED="1767491597527"/>
</node>
<node TEXT="Improved query" ID="ID_14849497" CREATED="1767491604228" MODIFIED="1767491609508">
<node TEXT="PROFILE MATCH (m:Movie)&#xa;WHERE m.imdbVotes IS NOT NULL&#xa;RETURN m.title, m.imdbVotes ORDER by m.imdbVotes DESC LIMIT 1" ID="ID_658232704" CREATED="1767491609513" MODIFIED="1767491617960"/>
</node>
</node>
<node TEXT="Use of indexes" ID="ID_165852380" CREATED="1767491315384" MODIFIED="1767491321212">
<node TEXT="If the property that you are comparing with min() or max() has an index on it, the index is used to return the value which is very efficient." ID="ID_106284670" CREATED="1767491773271" MODIFIED="1767491775258"/>
</node>
</node>
<node TEXT="3.6 Movies with Lowest Ratings" ID="ID_1960797264" CREATED="1767063349325" MODIFIED="1767063358781">
<node TEXT="determine the lowest rating a user gave to a movie and return the user name, rating, and movie title for that low rating.&#xa;&#xa;How many rows are returned?" ID="ID_467893331" CREATED="1767491841701" MODIFIED="1767491845479">
<node TEXT="MATCH ()-[r:RATED]-()&#xa;WITH min(r.rating) as LowRating&#xa;MATCH (u:User)-[r]-&gt;(m:Movie)&#xa;WHERE r.rating = LowRating&#xa;RETURN u.name, r.Rating, m.title" ID="ID_635315803" CREATED="1767493264888" MODIFIED="1767493266987"/>
<node TEXT="Answer: 1101" ID="ID_792847462" CREATED="1767493267945" MODIFIED="1767493273133"/>
</node>
</node>
<node TEXT="3.7 Working with Percentages and Percentiles" ID="ID_293727065" CREATED="1767063358907" MODIFIED="1767063370864">
<node TEXT="Calculating a percentage" ID="ID_230194831" CREATED="1767494167989" MODIFIED="1767494174262">
<node TEXT="What percentage of movies released in 2000 had a rating &gt; 4?" ID="ID_1335905575" CREATED="1767494231633" MODIFIED="1767494249847">
<node TEXT="MATCH (m:Movie) WHERE m.year = 2000&#xa;WITH count(*) AS TotalMovies&#xa;MATCH ()-[r:RATED]-(m) where r.rating &gt; 4 AND m.year = 2000&#xa;WITH count(DISTINCT m) AS GoodMovies, TotalMovies&#xa;RETURN TotalMovies, GoodMovies, GoodMovies/TotalMovies AS PercentGood" ID="ID_1289330196" CREATED="1767494566111" MODIFIED="1767494570336"/>
<node TEXT="MATCH (m:Movie) WHERE m.year = 2000&#xa;WITH count(*) AS TotalMovies&#xa;MATCH ()-[r:RATED]-(m) where r.rating &gt; 4 AND m.year = 2000&#xa;WITH count(DISTINCT m) AS GoodMovies, TotalMovies&#xa;RETURN TotalMovies, GoodMovies, round(toFloat(GoodMovies) / toFloat(TotalMovies) * 100) AS PercentGood" ID="ID_1466779051" CREATED="1767494578286" MODIFIED="1767494581890"/>
<node TEXT="MATCH (m:Movie) WHERE m.year = 2000&#xa;WITH count(*) AS TotalMovies&#xa;MATCH ()-[r:RATED]-(m) where r.rating &gt; 4 AND m.year = 2000&#xa;WITH count(DISTINCT m) AS GoodMovies, TotalMovies&#xa;RETURN TotalMovies, GoodMovies, round(toFloat(GoodMovies) / toFloat(TotalMovies),2) AS PercentGood" ID="ID_1314720199" CREATED="1767494625294" MODIFIED="1767494628661"/>
</node>
</node>
<node TEXT="Determine a percentile value from a list: percentileCont()" ID="ID_1416643800" CREATED="1767494680205" MODIFIED="1767494700196">
<node TEXT="evaluate a set of numeric values to determine the value that is at a percentile within the values. The calculation is done where the values are ordered. Then the element in the list that is at the correct percentile is returned. If the percentile is between two values, the average of the two values is returned." ID="ID_1820422326" CREATED="1767497443099" MODIFIED="1767497445292"/>
</node>
<node TEXT="Using percentileDisc() to select the nearest value from the list, rather than calculating an average if the two values are different" ID="ID_1147323465" CREATED="1767497767897" MODIFIED="1767497795401"/>
</node>
<node TEXT="3.8 75% of Actors Born After a Year" ID="ID_320381927" CREATED="1767063371037" MODIFIED="1767063381550">
<node TEXT="returns the year after which 75% of all Actors were born.&#xa;&#xa;What year is returned?" ID="ID_879070210" CREATED="1767497896820" MODIFIED="1767497899015">
<node TEXT="MATCH (a:Actor)&#xa;WITH collect(a.born.year) AS ActorBorn&#xa;UNWIND ActorBorn AS x&#xa;RETURN percentileDisc(x, 0.75)" ID="ID_779562463" CREATED="1767498069156" MODIFIED="1767498073354"/>
<node TEXT="Answer: 1972" ID="ID_877964592" CREATED="1767498073557" MODIFIED="1767498081337"/>
</node>
</node>
</node>
</node>
</map>
